<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Traxion</title>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
    font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
    background:#f3f4f6;
    color:#1f2937;
    min-height:100vh;
}

.container-fluid{
    display:flex;
    flex-wrap:wrap;
}

.sidebar{
    width:260px;
    background:#1f2937;
    min-height:100vh;
    padding:25px 20px;
}
.sidebar h2{
    color:#84cc16;
    text-align:center;
    margin-bottom:30px;
    font-size:28px;
}
.menu-item{
    padding:14px 18px;
    border-radius:10px;
    margin-bottom:12px;
    color:#d1d5db;
    font-weight:600;
    cursor:pointer;
    transition:all 0.3s;
}
.menu-item:hover{
    background:#374151;
}
.menu-item.active{
    background:#84cc16;
    color:#1f2937;
}

.content{
    flex:1;
    padding:30px;
    min-width:0;
}

header{
    background:linear-gradient(135deg,#1f2937,#374151);
    padding:30px;
    border-radius:14px;
    margin-bottom:20px;
}
header h1{
    color:#84cc16;
    font-size:32px;
    margin-bottom:8px;
}
.subtitle{
    color:#d1d5db;
    font-size:16px;
}

.filter-bar{
    margin:0 0 20px 0;
}
.filter-bar select{
    padding:12px 16px;
    border-radius:10px;
    border:2px solid #e5e7eb;
    font-size:15px;
    font-weight:600;
    min-width:250px;
    background:#ffffff;
    cursor:pointer;
    transition:border 0.3s;
}
.filter-bar select:focus{
    outline:none;
    border-color:#84cc16;
}

.kpi-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));
    gap:18px;
    margin-bottom:25px;
}

.kpi-card{
    background:#ffffff;
    border:2px solid #e5e7eb;
    border-radius:12px;
    padding:20px;
    transition:transform 0.2s, box-shadow 0.2s;
}
.kpi-card:hover{
    transform:translateY(-2px);
    box-shadow:0 4px 12px rgba(0,0,0,0.1);
}
.kpi-card.highlight{
    border-left:5px solid #84cc16;
}
.kpi-card.warning{
    border-left:5px solid #f59e0b;
}

.kpi-label{
    font-size:11px;
    font-weight:700;
    color:#6b7280;
    text-transform:uppercase;
    letter-spacing:0.5px;
    margin-bottom:8px;
}
.kpi-value{
    font-size:28px;
    font-weight:800;
    color:#1f2937;
    margin:8px 0;
}
.kpi-value.highlight{
    color:#84cc16;
}
.kpi-subvalue{
    font-size:12px;
    color:#9ca3af;
    margin-top:6px;
    line-height:1.4;
}

.chart-row{
    display:grid;
    grid-template-columns:repeat(auto-fit, minmax(400px, 1fr));
    gap:20px;
    margin-bottom:25px;
}

.chart-container{
    background:#ffffff;
    border:2px solid #e5e7eb;
    border-radius:12px;
    padding:20px;
    transition:transform 0.2s, box-shadow 0.2s;
}
.chart-container:hover{
    transform:translateY(-2px);
    box-shadow:0 4px 12px rgba(0,0,0,0.1);
}
.chart-container h3{
    font-size:16px;
    font-weight:700;
    margin-bottom:15px;
    color:#1f2937;
    padding-bottom:10px;
    border-bottom:2px solid #84cc16;
}
canvas{
    max-height:280px;
}

@media (max-width: 1400px){
    .kpi-grid{
        grid-template-columns:repeat(3, 1fr);
    }
}

@media (max-width: 1024px){
    .sidebar{
        width:100%;
        min-height:auto;
    }
    .container-fluid{
        flex-direction:column;
    }
    .kpi-grid{
        grid-template-columns:repeat(2, 1fr);
    }
    .chart-row{
        grid-template-columns:1fr;
    }
}

@media (max-width: 640px){
    .content{
        padding:15px;
    }
    header{
        padding:20px;
    }
    header h1{
        font-size:24px;
    }
    .kpi-grid{
        grid-template-columns:1fr;
    }
    .kpi-value{
        font-size:24px;
    }
    .filter-bar select{
        width:100%;
    }
}
</style>
<link rel="stylesheet" href="kilometros.css">
</head>

<body>
<section id="seccion-kilometros" class="seccion-dashboard">

    <header>
        <h1>Dashboard de Kil√≥metros Recorridos</h1>
        <p class="subtitle" id="headerPeriodo">Cargando datos...</p>
    </header>

    <div class="filter-bar">
        <select id="unidadNegocio">
            <option value="SETTEPI SALTILLO">SETTEPI SALTILLO</option>
            <option value="LIPU SALTILLO">LIPU SALTILLO</option>
        </select>
    </div>

    <!-- KPIs -->
    <div class="kpi-grid">
        <div class="kpi-card highlight">
            <div class="kpi-label">Total KM Recorridos</div>
            <div class="kpi-value highlight" id="kpiTotal">0 km</div>
            <div class="kpi-subvalue">Acumulado del periodo</div>
        </div>

        <div class="kpi-card">
            <div class="kpi-label">KM Permitidos</div>
            <div class="kpi-value" id="kpiPermitido">0 km</div>
            <div class="kpi-subvalue">L√≠mite establecido</div>
        </div>

        <div class="kpi-card highlight">
            <div class="kpi-label">Margen Disponible</div>
            <div class="kpi-value highlight" id="kpiMargen">0 km</div>
            <div class="kpi-subvalue" id="txtMargen">Calculando...</div>
        </div>

        <div class="kpi-card">
            <div class="kpi-label">KM de Servicio</div>
            <div class="kpi-value" id="kpiServicio">0 km</div>
            <div class="kpi-subvalue" id="pctServicio">0% del total</div>
        </div>

        <div class="kpi-card">
            <div class="kpi-label">KM Mtto / Carga / RH / Seg</div>
            <div class="kpi-value" id="kpiMtto">0 km</div>
            <div class="kpi-subvalue" id="pctMtto">0% del total</div>
        </div>

        <div class="kpi-card warning">
            <div class="kpi-label">KM Ineficiente (Vac√≠o)</div>
            <div class="kpi-value" id="kpiVacio">0 km</div>
            <div class="kpi-subvalue" id="pctVacio">0% del total</div>
        </div>
    </div>

    <!-- Gr√°ficas -->
    <div class="chart-row">
        <div class="chart-container">
            <h3>KM Recorridos vs Permitido por D√≠a</h3>
            <canvas id="chartProgreso"></canvas>
        </div>

        <div class="chart-container">
            <h3>Distribuci√≥n Total (%)</h3>
            <canvas id="chartDistribucion"></canvas>
        </div>

        <div class="chart-container">
            <h3>Comportamiento Diario</h3>
            <canvas id="chartDiario"></canvas>
        </div>
    </div>

    <!-- Tabla de Detalle -->
    <div class="chart-container">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;">
            <h3 style="margin:0;">Detalle por Cliente</h3>
            <button id="btnExportar" style="
                background:#84cc16;
                color:#1f2937;
                border:none;
                padding:10px 20px;
                border-radius:8px;
                font-weight:700;
                font-size:14px;
                cursor:pointer;
                transition:all 0.3s;
                box-shadow:0 2px 4px rgba(0,0,0,0.1);
            " onmouseover="this.style.background='#65a30d'" onmouseout="this.style.background='#84cc16'">
                üì• Exportar a Excel
            </button>
        </div>
        
        <!-- Filtros -->
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:10px;margin-bottom:15px;">
            <input type="text" id="filtroGerente" placeholder="üîç Filtrar Gerente" style="padding:8px;border:2px solid #e5e7eb;border-radius:6px;font-size:13px;">
            <input type="text" id="filtroJefe" placeholder="üîç Filtrar Jefe" style="padding:8px;border:2px solid #e5e7eb;border-radius:6px;font-size:13px;">
            <input type="text" id="filtroCliente" placeholder="üîç Filtrar Cliente" style="padding:8px;border:2px solid #e5e7eb;border-radius:6px;font-size:13px;">
            <button id="btnLimpiar" style="padding:8px;border:2px solid #e5e7eb;border-radius:6px;background:#fff;cursor:pointer;font-weight:600;" onclick="limpiarFiltros()">üóëÔ∏è Limpiar</button>
        </div>
        
        <div style="overflow-x:auto;">
            <table style="margin:0 auto;max-width:100%;">
                <thead>
                    <tr>
                        <th>Unidad de Negocio</th>
                        <th>Gerente de OP</th>
                        <th>Jefe de OP</th>
                        <th>Cliente</th>
                        <th>KM Recorridos</th>
                        <th>KM de Servicios</th>
                        <th>KM Mtto/Carga/RH/Seg</th>
                        <th>KM Ineficiente</th>
                        <th>% Vac√≠o</th>
                    </tr>
                </thead>
                <tbody id="tablaDetalle"></tbody>
            </table>
        </div>
    </div>

    </section>
<script src="kilometros.js"></script>
</body>
</html>